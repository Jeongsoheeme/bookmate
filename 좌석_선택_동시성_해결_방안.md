# ì¢Œì„ ì„ íƒ ë™ì‹œì„± ë¬¸ì œ í•´ê²° ë°©ì•ˆ

## ğŸ“‹ ëª©ì°¨

1. [ë¬¸ì œ ìƒí™©](#ë¬¸ì œ-ìƒí™©)
2. [í•´ê²° ì „ëµ](#í•´ê²°-ì „ëµ)
3. [êµ¬í˜„ ì„¸ë¶€ì‚¬í•­](#êµ¬í˜„-ì„¸ë¶€ì‚¬í•­)
4. [API íë¦„](#api-íë¦„)
5. [ì½”ë“œ êµ¬ì¡°](#ì½”ë“œ-êµ¬ì¡°)
6. [ì„±ëŠ¥ ìµœì í™”](#ì„±ëŠ¥-ìµœì í™”)
7. [ì¥ì•  ëŒ€ì‘](#ì¥ì• -ëŒ€ì‘)
8. [í…ŒìŠ¤íŠ¸](#í…ŒìŠ¤íŠ¸)

---

## ë¬¸ì œ ìƒí™©

### Race Condition ì‹œë‚˜ë¦¬ì˜¤

ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ê°™ì€ ì¢Œì„ì„ ì„ íƒí•  ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œ:

```
ì‹œê°„ | ì‚¬ìš©ì A                    | ì‚¬ìš©ì B                    | ë°ì´í„°ë² ì´ìŠ¤
-----|----------------------------|----------------------------|---------------
T1   | ì¢Œì„ 1ë²ˆ ì¡°íšŒ â†’ ì˜ˆì•½ ê°€ëŠ¥   |                            | ì¢Œì„ 1ë²ˆ: available
T2   |                            | ì¢Œì„ 1ë²ˆ ì¡°íšŒ â†’ ì˜ˆì•½ ê°€ëŠ¥  | ì¢Œì„ 1ë²ˆ: available
T3   | ì˜ˆì•½ ì§„í–‰...               |                            | 
T4   |                            | ì˜ˆì•½ ì§„í–‰...               |
T5   | ì˜ˆì•½ ì™„ë£Œ                  | ì˜ˆì•½ ì™„ë£Œ                  | âŒ ì¤‘ë³µ ì˜ˆì•½!
```

### ë°œìƒ ê°€ëŠ¥í•œ ë¬¸ì œì 

- **ì¤‘ë³µ ì˜ˆì•½**: ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ê°™ì€ ì¢Œì„ì„ ì˜ˆì•½
- **ë°ì´í„° ë¶ˆì¼ì¹˜**: DBì™€ ìºì‹œ ê°„ ë¶ˆì¼ì¹˜
- **ì‚¬ìš©ì ê²½í—˜ ì €í•˜**: ì˜ˆë§¤ í›„ ì·¨ì†Œë˜ëŠ” ìƒí™© ë°œìƒ
- **ì‹œìŠ¤í…œ ë¶€í•˜**: ë¶ˆí•„ìš”í•œ DB íŠ¸ëœì­ì…˜ ì¦ê°€

---

## í•´ê²° ì „ëµ

### ë‹¤ì¸µ ë°©ì–´ ì „ëµ (Defense in Depth)

í˜„ì¬ ì‹œìŠ¤í…œì€ **3ë‹¨ê³„ ë°©ì–´ ë©”ì»¤ë‹ˆì¦˜**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

1. **Redis ë¶„ì‚° LOCK** (1ë‹¨ê³„: ë¹ ë¥¸ ì°¨ë‹¨)
2. **DB ë ˆë²¨ LOCK** (2ë‹¨ê³„: ìµœì¢… ë³´ì¥)
3. **íŠ¸ëœì­ì…˜** (3ë‹¨ê³„: ì›ìì„± ë³´ì¥)

### ì•„í‚¤í…ì²˜ íë¦„

```
ì‚¬ìš©ì ìš”ì²­
    â†“
[1ë‹¨ê³„] Redis LOCK ì‹œë„
    â”œâ”€ ì„±ê³µ â†’ ë‹¤ìŒ ë‹¨ê³„
    â””â”€ ì‹¤íŒ¨ â†’ 409 Conflict ì‘ë‹µ (ì¦‰ì‹œ ë°˜í™˜)
    â†“
[2ë‹¨ê³„] DB íŠ¸ëœì­ì…˜ ì‹œì‘
    â†“
[3ë‹¨ê³„] SELECT FOR UPDATEë¡œ ì¢Œì„ LOCK
    â†“
[4ë‹¨ê³„] ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
    â”œâ”€ ê°€ëŠ¥ â†’ Booking ìƒì„±
    â””â”€ ë¶ˆê°€ëŠ¥ â†’ ë¡¤ë°± + Redis LOCK í•´ì œ
    â†“
[5ë‹¨ê³„] íŠ¸ëœì­ì…˜ ì»¤ë°‹
    â†“
[6ë‹¨ê³„] ìºì‹œ ë¬´íš¨í™” + Redis LOCK í•´ì œ
    â†“
ì„±ê³µ ì‘ë‹µ
```

---

## êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 1ë‹¨ê³„: Redis ë¶„ì‚° LOCK

**ëª©ì **: DB ë¶€í•˜ë¥¼ ì¤„ì´ê³  ë¹ ë¥´ê²Œ ì¤‘ë³µ ìš”ì²­ ì°¨ë‹¨

**êµ¬í˜„ ìœ„ì¹˜**: `backend/app/services/redis_service.py`

**ì£¼ìš” ë©”ì„œë“œ**:

```python
def try_lock_seat(ticket_id: int, timeout: int = None, user_id: int = None) -> bool:
    """
    ì¢Œì„ LOCK ì‹œë„ (ë…¼ë¸”ë¡œí‚¹)
    
    - SET NX EX ëª…ë ¹ì–´ ì‚¬ìš©
    - NX: í‚¤ê°€ ì—†ì„ ë•Œë§Œ ì„¤ì • (Not eXists)
    - EX: ë§Œë£Œ ì‹œê°„ ì„¤ì • (Expire, ê¸°ë³¸ 30ì´ˆ)
    """
    lock_key = f"seat_lock:{ticket_id}"
    lock_value = f"{user_id}:{uuid.uuid4()}" if user_id else str(uuid.uuid4())
    
    return bool(self.client.set(
        lock_key,
        lock_value,
        nx=True,  # í‚¤ê°€ ì—†ì„ ë•Œë§Œ ì„¤ì •
        ex=timeout or settings.SEAT_LOCK_TIMEOUT  # ê¸°ë³¸ 30ì´ˆ
    ))
```

**íŠ¹ì§•**:
- âœ… **ë¶„ì‚° í™˜ê²½ ì§€ì›**: ì—¬ëŸ¬ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ê°„ ë™ì‹œì„± ì œì–´
- âœ… **ë¹ ë¥¸ ì‘ë‹µ**: ë©”ëª¨ë¦¬ ê¸°ë°˜ìœ¼ë¡œ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ ì‘ë‹µ
- âœ… **ìë™ ë§Œë£Œ**: íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ë°ë“œë½ ë°©ì§€
- âœ… **ì‚¬ìš©ìë³„ LOCK**: ê°™ì€ ì‚¬ìš©ìì˜ ì¤‘ë³µ ìš”ì²­ í—ˆìš©

**LOCK í•´ì œ**:

```python
def unlock_seat(ticket_id: int, user_id: Optional[int] = None):
    """
    ì¢Œì„ LOCK í•´ì œ
    - ì‚¬ìš©ì IDê°€ ì œê³µë˜ë©´ í•´ë‹¹ ì‚¬ìš©ìì˜ LOCKë§Œ í•´ì œ
    - Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì›ìì  ì—°ì‚° ë³´ì¥
    """
    lock_key = f"seat_lock:{ticket_id}"
    # Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ìì‹ ì´ ì„¤ì •í•œ ê°’ì¸ì§€ í™•ì¸ í›„ ì‚­ì œ
    lua_script = """
    if redis.call("get", KEYS[1]) == ARGV[1] then
        return redis.call("del", KEYS[1])
    else
        return 0
    end
    """
    self.client.eval(lua_script, 1, lock_key, lock_value)
```

### 2ë‹¨ê³„: DB ë ˆë²¨ LOCK

**ëª©ì **: Redisë¥¼ ìš°íšŒí•œ ìš”ì²­ì´ë‚˜ Redis ì¥ì•  ì‹œ ìµœì¢… ë³´ì¥

**êµ¬í˜„ ìœ„ì¹˜**: `backend/app/api/v1/endpoints/tickets.py`

**êµ¬í˜„ ì½”ë“œ**:

```python
# SELECT FOR UPDATEë¡œ LOCK íšë“
ticket_query = db.query(Ticket).filter(
    Ticket.event_id == request.event_id,
    Ticket.seat_row == seat_info.row,
    Ticket.seat_number == seat_info.number
)
if request.schedule_id:
    ticket_query = ticket_query.filter(Ticket.schedule_id == request.schedule_id)

# SELECT FOR UPDATEë¡œ í–‰ ë ˆë²¨ LOCK
ticket = ticket_query.with_for_update().first()
```

**íŠ¹ì§•**:
- âœ… **ë°ì´í„° ì •í•©ì„± ë³´ì¥**: DBê°€ ìµœì¢… ì§„ì‹¤ì˜ ì†ŒìŠ¤ (Source of Truth)
- âœ… **íŠ¸ëœì­ì…˜ ë‚´ ì›ìì„±**: íŠ¸ëœì­ì…˜ ì»¤ë°‹/ë¡¤ë°±ìœ¼ë¡œ ì¼ê´€ì„± ìœ ì§€
- âœ… **Redis ì¥ì•  ëŒ€ì‘**: Redis ì¥ì•  ì‹œì—ë„ ë™ì‘

### 3ë‹¨ê³„: íŠ¸ëœì­ì…˜

**ëª©ì **: ì—¬ëŸ¬ ì¢Œì„ ì˜ˆë§¤ ì‹œ ì „ì²´ ì„±ê³µ ë˜ëŠ” ì „ì²´ ì‹¤íŒ¨ ë³´ì¥

**êµ¬í˜„**:

```python
try:
    # ëª¨ë“  ì¢Œì„ì— LOCK íšë“
    for seat_info in request.seats:
        # Redis LOCK ì‹œë„
        # DB LOCK íšë“
        # Booking ìƒì„±
    
    # ëª¨ë“  ì‘ì—…ì´ ì„±ê³µí•˜ë©´ ì»¤ë°‹
    db.commit()
    
    # ìºì‹œ ë¬´íš¨í™” ë° LOCK í•´ì œ
    redis_service.invalidate_seat_cache(request.event_id, request.schedule_id)
    for locked_id in locked_tickets:
        redis_service.unlock_seat(locked_id)
        
except Exception as e:
    # ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡¤ë°±
    db.rollback()
    # LOCK í•´ì œ
    for locked_id in locked_tickets:
        redis_service.unlock_seat(locked_id)
    raise
```

---

## API íë¦„

### 1. ì¢Œì„ ì ê¸ˆ API (`POST /api/v1/seats/lock`)

**ëª©ì **: ì¢Œì„ ì„ íƒ ì™„ë£Œ ì‹œì ì— ë¯¸ë¦¬ ì¢Œì„ì„ ì ê·¸ëŠ” API

**ìš”ì²­ ì˜ˆì‹œ**:

```json
POST /api/v1/seats/lock
{
  "event_id": 1,
  "schedule_id": 1,
  "seats": [
    {"row": "1ì—´", "number": 1},
    {"row": "1ì—´", "number": 2}
  ]
}
```

**ì²˜ë¦¬ íë¦„**:

1. ê° ì¢Œì„ì— ëŒ€í•´ Redis LOCK ì‹œë„
2. í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ëª¨ë“  LOCK í•´ì œ í›„ ì‹¤íŒ¨ ì‘ë‹µ
3. ëª¨ë“  ì¢Œì„ì— LOCK íšë“ ì„±ê³µ ì‹œ ì„±ê³µ ì‘ë‹µ

**ì‘ë‹µ ì˜ˆì‹œ**:

```json
{
  "success": true,
  "message": "2ê°œì˜ ì¢Œì„ì´ ì ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤.",
  "locked_seats": [
    {"row": "1ì—´", "number": 1, "ticket_id": 12345},
    {"row": "1ì—´", "number": 2, "ticket_id": 12346}
  ]
}
```

### 2. ì˜ˆì•½ ìƒì„± API (`POST /api/v1/bookings`)

**ëª©ì **: ì„ íƒí•œ ì¢Œì„ì— ëŒ€í•´ í‹°ì¼“ì„ ìƒì„±í•˜ê³  bookingì„ ìƒì„±

**ìš”ì²­ ì˜ˆì‹œ**:

```json
POST /api/v1/bookings
{
  "event_id": 1,
  "schedule_id": 1,
  "seats": [
    {
      "row": "1ì—´",
      "number": 1,
      "grade": "VIP",
      "price": 100000.0,
      "seat_section": "Aêµ¬ì—­"
    }
  ],
  "total_price": 100000.0,
  "receipt_method": "on_site"
}
```

**ì²˜ë¦¬ íë¦„**:

1. **Redis LOCK í™•ì¸**
   - ê¸°ì¡´ LOCK í™•ì¸
   - ê°™ì€ ì‚¬ìš©ìì˜ LOCKì´ë©´ ì¬ì‚¬ìš©
   - ë‹¤ë¥¸ ì‚¬ìš©ìì˜ LOCKì´ë©´ ì‹¤íŒ¨ (409 Conflict)

2. **DB íŠ¸ëœì­ì…˜ ì‹œì‘**

3. **SELECT FOR UPDATEë¡œ ì¢Œì„ LOCK**
   - DB ë ˆë²¨ì—ì„œ í–‰ ë ˆë²¨ LOCK íšë“

4. **ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸**
   - ì´ë¯¸ ì˜ˆì•½ëœ í‹°ì¼“ì¸ì§€ í™•ì¸
   - í‹°ì¼“ì´ ì—†ìœ¼ë©´ ìƒì„±

5. **Booking ìƒì„±**

6. **íŠ¸ëœì­ì…˜ ì»¤ë°‹**

7. **ìºì‹œ ë¬´íš¨í™” ë° LOCK í•´ì œ**

**ì‘ë‹µ ì˜ˆì‹œ**:

```json
[
  {
    "id": 1,
    "user_id": 1,
    "ticket_id": 12345,
    "status": "pending",
    "total_price": 100000.0,
    "booked_at": "2026-01-25T10:30:00"
  }
]
```

---

## ì½”ë“œ êµ¬ì¡°

### ì£¼ìš” íŒŒì¼ ë° ì—­í• 

#### 1. `backend/app/services/redis_service.py`

Redis ë¶„ì‚° LOCK ë° ìºì‹± ê´€ë¦¬

**ì£¼ìš” ë©”ì„œë“œ**:
- `try_lock_seat()`: ì¢Œì„ LOCK ì‹œë„
- `unlock_seat()`: ì¢Œì„ LOCK í•´ì œ
- `get_lock_user_id()`: LOCKì„ ê°€ì§€ê³  ìˆëŠ” ì‚¬ìš©ì ID ì¡°íšŒ
- `lock_seat()`: Context Managerë¡œ LOCK ê´€ë¦¬
- `invalidate_seat_cache()`: ì¢Œì„ ìƒíƒœ ìºì‹œ ë¬´íš¨í™”

#### 2. `backend/app/api/v1/endpoints/tickets.py`

ì¢Œì„ ì ê¸ˆ ë° ì˜ˆì•½ ìƒì„± API

**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸**:
- `POST /api/v1/seats/lock`: ì¢Œì„ ì ê¸ˆ
- `POST /api/v1/bookings`: ì˜ˆì•½ ìƒì„±
- `GET /api/v1/events/{event_id}/tickets`: í‹°ì¼“ ëª©ë¡ ì¡°íšŒ

#### 3. `backend/app/models/ticket.py`

í‹°ì¼“ ëª¨ë¸ ì •ì˜

#### 4. `backend/app/models/booking.py`

ì˜ˆì•½ ëª¨ë¸ ì •ì˜

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ì¢Œì„ ìƒíƒœ ìºì‹±

**ëª©ì **: ì¢Œì„ ì¡°íšŒ API ì„±ëŠ¥ í–¥ìƒ

**êµ¬í˜„**:

```python
# ì¢Œì„ ëª©ë¡ ì¡°íšŒ ì‹œ ìºì‹œ í™œìš©
cached_seats = redis_service.get_cached_event_seats(event_id, schedule_id)
if cached_seats:
    return cached_seats

# ìºì‹œ ë¯¸ìŠ¤ ì‹œ DB ì¡°íšŒ í›„ ìºì‹±
seats = db.query(Ticket).filter(...).all()
redis_service.cache_event_seats(event_id, schedule_id, seats_data, ttl=60)
```

**íš¨ê³¼**:
- DB ì¡°íšŒ íšŸìˆ˜ ê°ì†Œ
- ì‘ë‹µ ì‹œê°„ ë‹¨ì¶• (ë°€ë¦¬ì´ˆ â†’ ë§ˆì´í¬ë¡œì´ˆ)

### 2. ë°°ì¹˜ LOCK í•´ì œ

**ëª©ì **: ì—¬ëŸ¬ ì¢Œì„ ì˜ˆë§¤ ì‹œ íš¨ìœ¨ì ì¸ LOCK ê´€ë¦¬

**êµ¬í˜„**:

```python
locked_tickets = []
for seat in seats:
    if redis_service.try_lock_seat(seat_id, user_id=current_user.id):
        locked_tickets.append(seat_id)
    else:
        # ì‹¤íŒ¨ ì‹œ ì´ë¯¸ íšë“í•œ LOCK ëª¨ë‘ í•´ì œ
        for locked_id in locked_tickets:
            redis_service.unlock_seat(locked_id)
        raise HTTPException(...)
```

### 3. ê°™ì€ ì‚¬ìš©ì LOCK ì¬ì‚¬ìš©

**ëª©ì **: ê°™ì€ ì‚¬ìš©ìì˜ ì¤‘ë³µ ìš”ì²­ í—ˆìš© (ì¢Œì„ ì ê¸ˆ í›„ ì˜ˆì•½ ìƒì„± ì‹œ)

**êµ¬í˜„**:

```python
lock_user_id = redis_service.get_lock_user_id(ticket_id)

if lock_user_id is not None:
    if lock_user_id == current_user.id:
        # ê°™ì€ ì‚¬ìš©ìê°€ ì´ë¯¸ LOCKì„ ê°€ì§€ê³  ìˆìœ¼ë©´ ì¬ì‚¬ìš©
        lock_acquired = True
    else:
        # ë‹¤ë¥¸ ì‚¬ìš©ìê°€ LOCKì„ ê°€ì§€ê³  ìˆìŒ
        lock_acquired = False
else:
    # LOCKì´ ì—†ìœ¼ë©´ ìƒˆë¡œ íšë“ ì‹œë„
    lock_acquired = redis_service.try_lock_seat(ticket_id, user_id=current_user.id)
```

---

## ì¥ì•  ëŒ€ì‘

### Redis ì¥ì•  ì‹œ

**Fallback ì „ëµ**:

1. **DB LOCKë§Œìœ¼ë¡œ ë™ì‘**: Redis ì—†ì´ë„ DB LOCKë§Œìœ¼ë¡œ ë™ì‘ (ì„±ëŠ¥ ì €í•˜)
2. **Circuit Breaker**: Redis ì¥ì•  ê°ì§€ ì‹œ ìë™ ìš°íšŒ
3. **ì¬ì‹œë„ ë¡œì§**: ì¼ì‹œì  ì¥ì•  ëŒ€ì‘

**êµ¬í˜„**:

```python
try:
    lock_acquired = redis_service.try_lock_seat(ticket_id, user_id=current_user.id)
except Exception:
    # Redis ì¥ì•  ì‹œ ë¡œê¹…í•˜ê³  ê³„ì† ì§„í–‰ (DB LOCKìœ¼ë¡œ ë³´ì¥)
    logger.warning("Redis lock failed, continuing with DB lock only")
    lock_acquired = True  # DB LOCKìœ¼ë¡œ ë³´ì¥
```

### DB ì¥ì•  ì‹œ

1. **ì½ê¸° ì „ìš© ëª¨ë“œ**: ì¡°íšŒë§Œ í—ˆìš©, ì˜ˆë§¤ ì¤‘ë‹¨
2. **ì¥ì•  ë³µêµ¬**: ìë™ ì¬ì—°ê²° ë° ë³µêµ¬

---

## í…ŒìŠ¤íŠ¸

### ë™ì‹œì„± í…ŒìŠ¤íŠ¸

**íŒŒì¼**: `backend/tests/test_seat_concurrency.py`

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:

1. **ë½ ì—†ì´ ë™ì‹œ ì˜ˆì•½ ì‹œë„**
   - ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ê°™ì€ ì¢Œì„ ì˜ˆì•½
   - ì¤‘ë³µ ì˜ˆì•½ ë°œìƒ í™•ì¸

2. **ë½ì„ ì‚¬ìš©í•œ ë™ì‹œ ì˜ˆì•½ ì‹œë„**
   - ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ê°™ì€ ì¢Œì„ ì˜ˆì•½
   - ì •í™•íˆ 1ëª…ë§Œ ì„±ê³µ í™•ì¸

3. **ì¢Œì„ ì ê¸ˆ API í…ŒìŠ¤íŠ¸**
   - ì²« ë²ˆì§¸ ì‚¬ìš©ìê°€ ì¢Œì„ ì ê¸ˆ
   - ë‘ ë²ˆì§¸ ì‚¬ìš©ìì˜ ì ê¸ˆ ì‹œë„ ì‹¤íŒ¨ í™•ì¸

**ì‹¤í–‰ ë°©ë²•**:

```bash
cd backend
pytest tests/test_seat_concurrency.py -v -s
```

**ì˜ˆìƒ ê²°ê³¼**:

```
í…ŒìŠ¤íŠ¸ 2: ë½ì„ ì‚¬ìš©í•œ ë™ì‹œ ì˜ˆì•½ ì‹œë„
============================================================
ì´ ìš”ì²­ ìˆ˜: 5
ì„±ê³µí•œ ì˜ˆì•½: 1ê°œ âœ…
ì‹¤íŒ¨í•œ ì˜ˆì•½: 4ê°œ âœ…
âœ… ì„±ê³µ: ë½ ë•ë¶„ì— ì •í™•íˆ 1ëª…ë§Œ ì˜ˆë§¤ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!
```

---

## ì„¤ì • ê°€ì´ë“œ

### í™˜ê²½ ë³€ìˆ˜

```env
# Redis ì„¤ì •
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=your_password

# ì¢Œì„ LOCK íƒ€ì„ì•„ì›ƒ (ì´ˆ)
SEAT_LOCK_TIMEOUT=30
```

### ê¶Œì¥ ì„¤ì •ê°’

- **SEAT_LOCK_TIMEOUT**: 30ì´ˆ (ì˜ˆë§¤ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ ì‹œê°„ ê³ ë ¤)
- **ìºì‹œ TTL**: 60ì´ˆ (ì¢Œì„ ìƒíƒœ ë³€ê²½ ë¹ˆë„ ê³ ë ¤)
- **DB íŠ¸ëœì­ì…˜ íƒ€ì„ì•„ì›ƒ**: 10ì´ˆ

---

## ê²°ë¡ 

í˜„ì¬ ì‹œìŠ¤í…œì€ **ë‹¤ì¸µ ë°©ì–´ ì „ëµ**ì„ í†µí•´ ì¢Œì„ ì„ íƒ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤:

1. âœ… **Redis ë¶„ì‚° LOCK**: ë¹ ë¥¸ ì°¨ë‹¨, DB ë¶€í•˜ ê°ì†Œ
2. âœ… **DB ë ˆë²¨ LOCK**: ìµœì¢… ë³´ì¥, ë°ì´í„° ì •í•©ì„±
3. âœ… **íŠ¸ëœì­ì…˜**: ì›ìì„± ë³´ì¥, ì¼ê´€ì„± ìœ ì§€

ì´ ì¡°í•©ìœ¼ë¡œ **í™•ì¥ ê°€ëŠ¥í•˜ê³  ì•ˆì •ì ì¸** ì¢Œì„ ì˜ˆë§¤ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ì°¸ê³  ë¬¸ì„œ

- `backend/docs/SEAT_LOCKING_ARCHITECTURE.md`: ì¢Œì„ ì ê¸ˆ ì•„í‚¤í…ì²˜ ìƒì„¸ ì„¤ëª…
- `backend/tests/README_ë™ì‹œì„±_í…ŒìŠ¤íŠ¸.md`: ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
- `backend/app/services/redis_service.py`: Redis ì„œë¹„ìŠ¤ êµ¬í˜„
- `backend/app/api/v1/endpoints/tickets.py`: ì¢Œì„ ì ê¸ˆ ë° ì˜ˆì•½ API êµ¬í˜„
